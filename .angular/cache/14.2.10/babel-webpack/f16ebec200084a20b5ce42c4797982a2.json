{"ast":null,"code":"import { canUseAsyncIteratorSymbol } from \"../../../utilities/index.js\";\nexport default function nodeStreamIterator(stream) {\n  var cleanup = null;\n  var error = null;\n  var done = false;\n  var data = [];\n  var waiting = [];\n\n  function onData(chunk) {\n    if (error) return;\n\n    if (waiting.length) {\n      var shiftedArr = waiting.shift();\n\n      if (Array.isArray(shiftedArr) && shiftedArr[0]) {\n        return shiftedArr[0]({\n          value: chunk,\n          done: false\n        });\n      }\n    }\n\n    data.push(chunk);\n  }\n\n  function onError(err) {\n    error = err;\n    var all = waiting.slice();\n    all.forEach(function (pair) {\n      pair[1](err);\n    });\n    !cleanup || cleanup();\n  }\n\n  function onEnd() {\n    done = true;\n    var all = waiting.slice();\n    all.forEach(function (pair) {\n      pair[0]({\n        value: undefined,\n        done: true\n      });\n    });\n    !cleanup || cleanup();\n  }\n\n  cleanup = function () {\n    cleanup = null;\n    stream.removeListener(\"data\", onData);\n    stream.removeListener(\"error\", onError);\n    stream.removeListener(\"end\", onEnd);\n    stream.removeListener(\"finish\", onEnd);\n    stream.removeListener(\"close\", onEnd);\n  };\n\n  stream.on(\"data\", onData);\n  stream.on(\"error\", onError);\n  stream.on(\"end\", onEnd);\n  stream.on(\"finish\", onEnd);\n  stream.on(\"close\", onEnd);\n\n  function getNext() {\n    return new Promise(function (resolve, reject) {\n      if (error) return reject(error);\n      if (data.length) return resolve({\n        value: data.shift(),\n        done: false\n      });\n      if (done) return resolve({\n        value: undefined,\n        done: true\n      });\n      waiting.push([resolve, reject]);\n    });\n  }\n\n  var iterator = {\n    next: function () {\n      return getNext();\n    }\n  };\n\n  if (canUseAsyncIteratorSymbol) {\n    iterator[Symbol.asyncIterator] = function () {\n      return this;\n    };\n  }\n\n  return iterator;\n}","map":{"version":3,"names":["canUseAsyncIteratorSymbol","nodeStreamIterator","stream","cleanup","error","done","data","waiting","onData","chunk","length","shiftedArr","shift","Array","isArray","value","push","onError","err","all","slice","forEach","pair","onEnd","undefined","removeListener","on","getNext","Promise","resolve","reject","iterator","next","Symbol","asyncIterator"],"sources":["F:/Bureau/Test_MachinesTalk/MachinesTalk/node_modules/@apollo/client/link/http/iterators/nodeStream.js"],"sourcesContent":["import { canUseAsyncIteratorSymbol } from \"../../../utilities/index.js\";\nexport default function nodeStreamIterator(stream) {\n    var cleanup = null;\n    var error = null;\n    var done = false;\n    var data = [];\n    var waiting = [];\n    function onData(chunk) {\n        if (error)\n            return;\n        if (waiting.length) {\n            var shiftedArr = waiting.shift();\n            if (Array.isArray(shiftedArr) && shiftedArr[0]) {\n                return shiftedArr[0]({ value: chunk, done: false });\n            }\n        }\n        data.push(chunk);\n    }\n    function onError(err) {\n        error = err;\n        var all = waiting.slice();\n        all.forEach(function (pair) {\n            pair[1](err);\n        });\n        !cleanup || cleanup();\n    }\n    function onEnd() {\n        done = true;\n        var all = waiting.slice();\n        all.forEach(function (pair) {\n            pair[0]({ value: undefined, done: true });\n        });\n        !cleanup || cleanup();\n    }\n    cleanup = function () {\n        cleanup = null;\n        stream.removeListener(\"data\", onData);\n        stream.removeListener(\"error\", onError);\n        stream.removeListener(\"end\", onEnd);\n        stream.removeListener(\"finish\", onEnd);\n        stream.removeListener(\"close\", onEnd);\n    };\n    stream.on(\"data\", onData);\n    stream.on(\"error\", onError);\n    stream.on(\"end\", onEnd);\n    stream.on(\"finish\", onEnd);\n    stream.on(\"close\", onEnd);\n    function getNext() {\n        return new Promise(function (resolve, reject) {\n            if (error)\n                return reject(error);\n            if (data.length)\n                return resolve({ value: data.shift(), done: false });\n            if (done)\n                return resolve({ value: undefined, done: true });\n            waiting.push([resolve, reject]);\n        });\n    }\n    var iterator = {\n        next: function () {\n            return getNext();\n        },\n    };\n    if (canUseAsyncIteratorSymbol) {\n        iterator[Symbol.asyncIterator] = function () {\n            return this;\n        };\n    }\n    return iterator;\n}\n"],"mappings":"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"},"metadata":{},"sourceType":"module"}