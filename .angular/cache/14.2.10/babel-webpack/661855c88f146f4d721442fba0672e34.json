{"ast":null,"code":"import { __assign, __awaiter, __generator } from \"tslib\";\nimport { invariant, InvariantError } from \"../utilities/globals/index.js\";\nimport { equal } from '@wry/equality';\nimport { execute } from \"../link/core/index.js\";\nimport { isExecutionPatchIncrementalResult, isExecutionPatchResult } from \"../utilities/common/incrementalResult.js\";\nimport { canonicalStringify } from \"../cache/index.js\";\nimport { getDefaultValues, getOperationDefinition, getOperationName, hasClientExports, graphQLResultHasError, getGraphQLErrorsFromResult, removeConnectionDirectiveFromDocument, canUseWeakMap, Observable, asyncMap, isNonEmptyArray, Concast, makeUniqueId, isDocumentNode, isNonNullObject } from \"../utilities/index.js\";\nimport { mergeIncrementalData } from \"../utilities/common/incrementalResult.js\";\nimport { ApolloError, isApolloError } from \"../errors/index.js\";\nimport { ObservableQuery, logMissingFieldErrors } from \"./ObservableQuery.js\";\nimport { NetworkStatus, isNetworkRequestInFlight } from \"./networkStatus.js\";\nimport { LocalState } from \"./LocalState.js\";\nimport { QueryInfo, shouldWriteResult } from \"./QueryInfo.js\";\nvar hasOwnProperty = Object.prototype.hasOwnProperty;\n\nvar QueryManager = function () {\n  function QueryManager(_a) {\n    var cache = _a.cache,\n        link = _a.link,\n        defaultOptions = _a.defaultOptions,\n        _b = _a.queryDeduplication,\n        queryDeduplication = _b === void 0 ? false : _b,\n        onBroadcast = _a.onBroadcast,\n        _c = _a.ssrMode,\n        ssrMode = _c === void 0 ? false : _c,\n        _d = _a.clientAwareness,\n        clientAwareness = _d === void 0 ? {} : _d,\n        localState = _a.localState,\n        assumeImmutableResults = _a.assumeImmutableResults;\n    this.clientAwareness = {};\n    this.queries = new Map();\n    this.fetchCancelFns = new Map();\n    this.transformCache = new (canUseWeakMap ? WeakMap : Map)();\n    this.queryIdCounter = 1;\n    this.requestIdCounter = 1;\n    this.mutationIdCounter = 1;\n    this.inFlightLinkObservables = new Map();\n    this.cache = cache;\n    this.link = link;\n    this.defaultOptions = defaultOptions || Object.create(null);\n    this.queryDeduplication = queryDeduplication;\n    this.clientAwareness = clientAwareness;\n    this.localState = localState || new LocalState({\n      cache: cache\n    });\n    this.ssrMode = ssrMode;\n    this.assumeImmutableResults = !!assumeImmutableResults;\n\n    if (this.onBroadcast = onBroadcast) {\n      this.mutationStore = Object.create(null);\n    }\n  }\n\n  QueryManager.prototype.stop = function () {\n    var _this = this;\n\n    this.queries.forEach(function (_info, queryId) {\n      _this.stopQueryNoBroadcast(queryId);\n    });\n    this.cancelPendingFetches(__DEV__ ? new InvariantError('QueryManager stopped while query was in flight') : new InvariantError(13));\n  };\n\n  QueryManager.prototype.cancelPendingFetches = function (error) {\n    this.fetchCancelFns.forEach(function (cancel) {\n      return cancel(error);\n    });\n    this.fetchCancelFns.clear();\n  };\n\n  QueryManager.prototype.mutate = function (_a) {\n    var _b, _c;\n\n    var mutation = _a.mutation,\n        variables = _a.variables,\n        optimisticResponse = _a.optimisticResponse,\n        updateQueries = _a.updateQueries,\n        _d = _a.refetchQueries,\n        refetchQueries = _d === void 0 ? [] : _d,\n        _e = _a.awaitRefetchQueries,\n        awaitRefetchQueries = _e === void 0 ? false : _e,\n        updateWithProxyFn = _a.update,\n        onQueryUpdated = _a.onQueryUpdated,\n        _f = _a.fetchPolicy,\n        fetchPolicy = _f === void 0 ? ((_b = this.defaultOptions.mutate) === null || _b === void 0 ? void 0 : _b.fetchPolicy) || \"network-only\" : _f,\n        _g = _a.errorPolicy,\n        errorPolicy = _g === void 0 ? ((_c = this.defaultOptions.mutate) === null || _c === void 0 ? void 0 : _c.errorPolicy) || \"none\" : _g,\n        keepRootFields = _a.keepRootFields,\n        context = _a.context;\n    return __awaiter(this, void 0, void 0, function () {\n      var mutationId, _h, document, hasClientExports, mutationStoreValue, self;\n\n      return __generator(this, function (_j) {\n        switch (_j.label) {\n          case 0:\n            __DEV__ ? invariant(mutation, 'mutation option is required. You must specify your GraphQL document in the mutation option.') : invariant(mutation, 14);\n            __DEV__ ? invariant(fetchPolicy === 'network-only' || fetchPolicy === 'no-cache', \"Mutations support only 'network-only' or 'no-cache' fetchPolicy strings. The default `network-only` behavior automatically writes mutation results to the cache. Passing `no-cache` skips the cache write.\") : invariant(fetchPolicy === 'network-only' || fetchPolicy === 'no-cache', 15);\n            mutationId = this.generateMutationId();\n            _h = this.transform(mutation), document = _h.document, hasClientExports = _h.hasClientExports;\n            mutation = this.cache.transformForLink(document);\n            variables = this.getVariables(mutation, variables);\n            if (!hasClientExports) return [3, 2];\n            return [4, this.localState.addExportedVariables(mutation, variables, context)];\n\n          case 1:\n            variables = _j.sent();\n            _j.label = 2;\n\n          case 2:\n            mutationStoreValue = this.mutationStore && (this.mutationStore[mutationId] = {\n              mutation: mutation,\n              variables: variables,\n              loading: true,\n              error: null\n            });\n\n            if (optimisticResponse) {\n              this.markMutationOptimistic(optimisticResponse, {\n                mutationId: mutationId,\n                document: mutation,\n                variables: variables,\n                fetchPolicy: fetchPolicy,\n                errorPolicy: errorPolicy,\n                context: context,\n                updateQueries: updateQueries,\n                update: updateWithProxyFn,\n                keepRootFields: keepRootFields\n              });\n            }\n\n            this.broadcastQueries();\n            self = this;\n            return [2, new Promise(function (resolve, reject) {\n              return asyncMap(self.getObservableFromLink(mutation, __assign(__assign({}, context), {\n                optimisticResponse: optimisticResponse\n              }), variables, false), function (result) {\n                if (graphQLResultHasError(result) && errorPolicy === 'none') {\n                  throw new ApolloError({\n                    graphQLErrors: getGraphQLErrorsFromResult(result)\n                  });\n                }\n\n                if (mutationStoreValue) {\n                  mutationStoreValue.loading = false;\n                  mutationStoreValue.error = null;\n                }\n\n                var storeResult = __assign({}, result);\n\n                if (typeof refetchQueries === \"function\") {\n                  refetchQueries = refetchQueries(storeResult);\n                }\n\n                if (errorPolicy === 'ignore' && graphQLResultHasError(storeResult)) {\n                  delete storeResult.errors;\n                }\n\n                return self.markMutationResult({\n                  mutationId: mutationId,\n                  result: storeResult,\n                  document: mutation,\n                  variables: variables,\n                  fetchPolicy: fetchPolicy,\n                  errorPolicy: errorPolicy,\n                  context: context,\n                  update: updateWithProxyFn,\n                  updateQueries: updateQueries,\n                  awaitRefetchQueries: awaitRefetchQueries,\n                  refetchQueries: refetchQueries,\n                  removeOptimistic: optimisticResponse ? mutationId : void 0,\n                  onQueryUpdated: onQueryUpdated,\n                  keepRootFields: keepRootFields\n                });\n              }).subscribe({\n                next: function (storeResult) {\n                  self.broadcastQueries();\n\n                  if (!('hasNext' in storeResult) || storeResult.hasNext === false) {\n                    resolve(storeResult);\n                  }\n                },\n                error: function (err) {\n                  if (mutationStoreValue) {\n                    mutationStoreValue.loading = false;\n                    mutationStoreValue.error = err;\n                  }\n\n                  if (optimisticResponse) {\n                    self.cache.removeOptimistic(mutationId);\n                  }\n\n                  self.broadcastQueries();\n                  reject(err instanceof ApolloError ? err : new ApolloError({\n                    networkError: err\n                  }));\n                }\n              });\n            })];\n        }\n      });\n    });\n  };\n\n  QueryManager.prototype.markMutationResult = function (mutation, cache) {\n    var _this = this;\n\n    if (cache === void 0) {\n      cache = this.cache;\n    }\n\n    var result = mutation.result;\n    var cacheWrites = [];\n    var skipCache = mutation.fetchPolicy === \"no-cache\";\n\n    if (!skipCache && shouldWriteResult(result, mutation.errorPolicy)) {\n      if (!isExecutionPatchIncrementalResult(result)) {\n        cacheWrites.push({\n          result: result.data,\n          dataId: 'ROOT_MUTATION',\n          query: mutation.document,\n          variables: mutation.variables\n        });\n      }\n\n      if (isExecutionPatchIncrementalResult(result) && isNonEmptyArray(result.incremental)) {\n        var diff = cache.diff({\n          id: \"ROOT_MUTATION\",\n          query: this.transform(mutation.document).asQuery,\n          variables: mutation.variables,\n          optimistic: false,\n          returnPartialData: true\n        });\n        var mergedData = mergeIncrementalData(diff.result, result);\n\n        if (typeof mergedData !== 'undefined') {\n          result.data = mergedData;\n          cacheWrites.push({\n            result: mergedData,\n            dataId: 'ROOT_MUTATION',\n            query: mutation.document,\n            variables: mutation.variables\n          });\n        }\n      }\n\n      var updateQueries_1 = mutation.updateQueries;\n\n      if (updateQueries_1) {\n        this.queries.forEach(function (_a, queryId) {\n          var observableQuery = _a.observableQuery;\n          var queryName = observableQuery && observableQuery.queryName;\n\n          if (!queryName || !hasOwnProperty.call(updateQueries_1, queryName)) {\n            return;\n          }\n\n          var updater = updateQueries_1[queryName];\n\n          var _b = _this.queries.get(queryId),\n              document = _b.document,\n              variables = _b.variables;\n\n          var _c = cache.diff({\n            query: document,\n            variables: variables,\n            returnPartialData: true,\n            optimistic: false\n          }),\n              currentQueryResult = _c.result,\n              complete = _c.complete;\n\n          if (complete && currentQueryResult) {\n            var nextQueryResult = updater(currentQueryResult, {\n              mutationResult: result,\n              queryName: document && getOperationName(document) || void 0,\n              queryVariables: variables\n            });\n\n            if (nextQueryResult) {\n              cacheWrites.push({\n                result: nextQueryResult,\n                dataId: 'ROOT_QUERY',\n                query: document,\n                variables: variables\n              });\n            }\n          }\n        });\n      }\n    }\n\n    if (cacheWrites.length > 0 || mutation.refetchQueries || mutation.update || mutation.onQueryUpdated || mutation.removeOptimistic) {\n      var results_1 = [];\n      this.refetchQueries({\n        updateCache: function (cache) {\n          if (!skipCache) {\n            cacheWrites.forEach(function (write) {\n              return cache.write(write);\n            });\n          }\n\n          var update = mutation.update;\n          var isFinalResult = !isExecutionPatchResult(result) || isExecutionPatchIncrementalResult(result) && !result.hasNext;\n\n          if (update) {\n            if (!skipCache) {\n              var diff = cache.diff({\n                id: \"ROOT_MUTATION\",\n                query: _this.transform(mutation.document).asQuery,\n                variables: mutation.variables,\n                optimistic: false,\n                returnPartialData: true\n              });\n\n              if (diff.complete) {\n                result = __assign(__assign({}, result), {\n                  data: diff.result\n                });\n\n                if ('incremental' in result) {\n                  delete result.incremental;\n                }\n\n                if ('hasNext' in result) {\n                  delete result.hasNext;\n                }\n              }\n            }\n\n            if (isFinalResult) {\n              update(cache, result, {\n                context: mutation.context,\n                variables: mutation.variables\n              });\n            }\n          }\n\n          if (!skipCache && !mutation.keepRootFields && isFinalResult) {\n            cache.modify({\n              id: 'ROOT_MUTATION',\n              fields: function (value, _a) {\n                var fieldName = _a.fieldName,\n                    DELETE = _a.DELETE;\n                return fieldName === \"__typename\" ? value : DELETE;\n              }\n            });\n          }\n        },\n        include: mutation.refetchQueries,\n        optimistic: false,\n        removeOptimistic: mutation.removeOptimistic,\n        onQueryUpdated: mutation.onQueryUpdated || null\n      }).forEach(function (result) {\n        return results_1.push(result);\n      });\n\n      if (mutation.awaitRefetchQueries || mutation.onQueryUpdated) {\n        return Promise.all(results_1).then(function () {\n          return result;\n        });\n      }\n    }\n\n    return Promise.resolve(result);\n  };\n\n  QueryManager.prototype.markMutationOptimistic = function (optimisticResponse, mutation) {\n    var _this = this;\n\n    var data = typeof optimisticResponse === \"function\" ? optimisticResponse(mutation.variables) : optimisticResponse;\n    return this.cache.recordOptimisticTransaction(function (cache) {\n      try {\n        _this.markMutationResult(__assign(__assign({}, mutation), {\n          result: {\n            data: data\n          }\n        }), cache);\n      } catch (error) {\n        __DEV__ && invariant.error(error);\n      }\n    }, mutation.mutationId);\n  };\n\n  QueryManager.prototype.fetchQuery = function (queryId, options, networkStatus) {\n    return this.fetchQueryObservable(queryId, options, networkStatus).promise;\n  };\n\n  QueryManager.prototype.getQueryStore = function () {\n    var store = Object.create(null);\n    this.queries.forEach(function (info, queryId) {\n      store[queryId] = {\n        variables: info.variables,\n        networkStatus: info.networkStatus,\n        networkError: info.networkError,\n        graphQLErrors: info.graphQLErrors\n      };\n    });\n    return store;\n  };\n\n  QueryManager.prototype.resetErrors = function (queryId) {\n    var queryInfo = this.queries.get(queryId);\n\n    if (queryInfo) {\n      queryInfo.networkError = undefined;\n      queryInfo.graphQLErrors = [];\n    }\n  };\n\n  QueryManager.prototype.transform = function (document) {\n    var transformCache = this.transformCache;\n\n    if (!transformCache.has(document)) {\n      var transformed = this.cache.transformDocument(document);\n      var noConnection = removeConnectionDirectiveFromDocument(transformed);\n      var clientQuery = this.localState.clientQuery(transformed);\n      var serverQuery = noConnection && this.localState.serverQuery(noConnection);\n      var cacheEntry_1 = {\n        document: transformed,\n        hasClientExports: hasClientExports(transformed),\n        hasForcedResolvers: this.localState.shouldForceResolvers(transformed),\n        clientQuery: clientQuery,\n        serverQuery: serverQuery,\n        defaultVars: getDefaultValues(getOperationDefinition(transformed)),\n        asQuery: __assign(__assign({}, transformed), {\n          definitions: transformed.definitions.map(function (def) {\n            if (def.kind === \"OperationDefinition\" && def.operation !== \"query\") {\n              return __assign(__assign({}, def), {\n                operation: \"query\"\n              });\n            }\n\n            return def;\n          })\n        })\n      };\n\n      var add = function (doc) {\n        if (doc && !transformCache.has(doc)) {\n          transformCache.set(doc, cacheEntry_1);\n        }\n      };\n\n      add(document);\n      add(transformed);\n      add(clientQuery);\n      add(serverQuery);\n    }\n\n    return transformCache.get(document);\n  };\n\n  QueryManager.prototype.getVariables = function (document, variables) {\n    return __assign(__assign({}, this.transform(document).defaultVars), variables);\n  };\n\n  QueryManager.prototype.watchQuery = function (options) {\n    options = __assign(__assign({}, options), {\n      variables: this.getVariables(options.query, options.variables)\n    });\n\n    if (typeof options.notifyOnNetworkStatusChange === 'undefined') {\n      options.notifyOnNetworkStatusChange = false;\n    }\n\n    var queryInfo = new QueryInfo(this);\n    var observable = new ObservableQuery({\n      queryManager: this,\n      queryInfo: queryInfo,\n      options: options\n    });\n    this.queries.set(observable.queryId, queryInfo);\n    queryInfo.init({\n      document: observable.query,\n      observableQuery: observable,\n      variables: observable.variables\n    });\n    return observable;\n  };\n\n  QueryManager.prototype.query = function (options, queryId) {\n    var _this = this;\n\n    if (queryId === void 0) {\n      queryId = this.generateQueryId();\n    }\n\n    __DEV__ ? invariant(options.query, 'query option is required. You must specify your GraphQL document ' + 'in the query option.') : invariant(options.query, 16);\n    __DEV__ ? invariant(options.query.kind === 'Document', 'You must wrap the query string in a \"gql\" tag.') : invariant(options.query.kind === 'Document', 17);\n    __DEV__ ? invariant(!options.returnPartialData, 'returnPartialData option only supported on watchQuery.') : invariant(!options.returnPartialData, 18);\n    __DEV__ ? invariant(!options.pollInterval, 'pollInterval option only supported on watchQuery.') : invariant(!options.pollInterval, 19);\n    return this.fetchQuery(queryId, options).finally(function () {\n      return _this.stopQuery(queryId);\n    });\n  };\n\n  QueryManager.prototype.generateQueryId = function () {\n    return String(this.queryIdCounter++);\n  };\n\n  QueryManager.prototype.generateRequestId = function () {\n    return this.requestIdCounter++;\n  };\n\n  QueryManager.prototype.generateMutationId = function () {\n    return String(this.mutationIdCounter++);\n  };\n\n  QueryManager.prototype.stopQueryInStore = function (queryId) {\n    this.stopQueryInStoreNoBroadcast(queryId);\n    this.broadcastQueries();\n  };\n\n  QueryManager.prototype.stopQueryInStoreNoBroadcast = function (queryId) {\n    var queryInfo = this.queries.get(queryId);\n    if (queryInfo) queryInfo.stop();\n  };\n\n  QueryManager.prototype.clearStore = function (options) {\n    if (options === void 0) {\n      options = {\n        discardWatches: true\n      };\n    }\n\n    this.cancelPendingFetches(__DEV__ ? new InvariantError('Store reset while query was in flight (not completed in link chain)') : new InvariantError(20));\n    this.queries.forEach(function (queryInfo) {\n      if (queryInfo.observableQuery) {\n        queryInfo.networkStatus = NetworkStatus.loading;\n      } else {\n        queryInfo.stop();\n      }\n    });\n\n    if (this.mutationStore) {\n      this.mutationStore = Object.create(null);\n    }\n\n    return this.cache.reset(options);\n  };\n\n  QueryManager.prototype.getObservableQueries = function (include) {\n    var _this = this;\n\n    if (include === void 0) {\n      include = \"active\";\n    }\n\n    var queries = new Map();\n    var queryNamesAndDocs = new Map();\n    var legacyQueryOptions = new Set();\n\n    if (Array.isArray(include)) {\n      include.forEach(function (desc) {\n        if (typeof desc === \"string\") {\n          queryNamesAndDocs.set(desc, false);\n        } else if (isDocumentNode(desc)) {\n          queryNamesAndDocs.set(_this.transform(desc).document, false);\n        } else if (isNonNullObject(desc) && desc.query) {\n          legacyQueryOptions.add(desc);\n        }\n      });\n    }\n\n    this.queries.forEach(function (_a, queryId) {\n      var oq = _a.observableQuery,\n          document = _a.document;\n\n      if (oq) {\n        if (include === \"all\") {\n          queries.set(queryId, oq);\n          return;\n        }\n\n        var queryName = oq.queryName,\n            fetchPolicy = oq.options.fetchPolicy;\n\n        if (fetchPolicy === \"standby\" || include === \"active\" && !oq.hasObservers()) {\n          return;\n        }\n\n        if (include === \"active\" || queryName && queryNamesAndDocs.has(queryName) || document && queryNamesAndDocs.has(document)) {\n          queries.set(queryId, oq);\n          if (queryName) queryNamesAndDocs.set(queryName, true);\n          if (document) queryNamesAndDocs.set(document, true);\n        }\n      }\n    });\n\n    if (legacyQueryOptions.size) {\n      legacyQueryOptions.forEach(function (options) {\n        var queryId = makeUniqueId(\"legacyOneTimeQuery\");\n\n        var queryInfo = _this.getQuery(queryId).init({\n          document: options.query,\n          variables: options.variables\n        });\n\n        var oq = new ObservableQuery({\n          queryManager: _this,\n          queryInfo: queryInfo,\n          options: __assign(__assign({}, options), {\n            fetchPolicy: \"network-only\"\n          })\n        });\n        invariant(oq.queryId === queryId);\n        queryInfo.setObservableQuery(oq);\n        queries.set(queryId, oq);\n      });\n    }\n\n    if (__DEV__ && queryNamesAndDocs.size) {\n      queryNamesAndDocs.forEach(function (included, nameOrDoc) {\n        if (!included) {\n          __DEV__ && invariant.warn(\"Unknown query \".concat(typeof nameOrDoc === \"string\" ? \"named \" : \"\").concat(JSON.stringify(nameOrDoc, null, 2), \" requested in refetchQueries options.include array\"));\n        }\n      });\n    }\n\n    return queries;\n  };\n\n  QueryManager.prototype.reFetchObservableQueries = function (includeStandby) {\n    var _this = this;\n\n    if (includeStandby === void 0) {\n      includeStandby = false;\n    }\n\n    var observableQueryPromises = [];\n    this.getObservableQueries(includeStandby ? \"all\" : \"active\").forEach(function (observableQuery, queryId) {\n      var fetchPolicy = observableQuery.options.fetchPolicy;\n      observableQuery.resetLastResults();\n\n      if (includeStandby || fetchPolicy !== \"standby\" && fetchPolicy !== \"cache-only\") {\n        observableQueryPromises.push(observableQuery.refetch());\n      }\n\n      _this.getQuery(queryId).setDiff(null);\n    });\n    this.broadcastQueries();\n    return Promise.all(observableQueryPromises);\n  };\n\n  QueryManager.prototype.setObservableQuery = function (observableQuery) {\n    this.getQuery(observableQuery.queryId).setObservableQuery(observableQuery);\n  };\n\n  QueryManager.prototype.startGraphQLSubscription = function (_a) {\n    var _this = this;\n\n    var query = _a.query,\n        fetchPolicy = _a.fetchPolicy,\n        errorPolicy = _a.errorPolicy,\n        variables = _a.variables,\n        _b = _a.context,\n        context = _b === void 0 ? {} : _b;\n    query = this.transform(query).document;\n    variables = this.getVariables(query, variables);\n\n    var makeObservable = function (variables) {\n      return _this.getObservableFromLink(query, context, variables).map(function (result) {\n        if (fetchPolicy !== 'no-cache') {\n          if (shouldWriteResult(result, errorPolicy)) {\n            _this.cache.write({\n              query: query,\n              result: result.data,\n              dataId: 'ROOT_SUBSCRIPTION',\n              variables: variables\n            });\n          }\n\n          _this.broadcastQueries();\n        }\n\n        if (graphQLResultHasError(result)) {\n          throw new ApolloError({\n            graphQLErrors: result.errors\n          });\n        }\n\n        return result;\n      });\n    };\n\n    if (this.transform(query).hasClientExports) {\n      var observablePromise_1 = this.localState.addExportedVariables(query, variables, context).then(makeObservable);\n      return new Observable(function (observer) {\n        var sub = null;\n        observablePromise_1.then(function (observable) {\n          return sub = observable.subscribe(observer);\n        }, observer.error);\n        return function () {\n          return sub && sub.unsubscribe();\n        };\n      });\n    }\n\n    return makeObservable(variables);\n  };\n\n  QueryManager.prototype.stopQuery = function (queryId) {\n    this.stopQueryNoBroadcast(queryId);\n    this.broadcastQueries();\n  };\n\n  QueryManager.prototype.stopQueryNoBroadcast = function (queryId) {\n    this.stopQueryInStoreNoBroadcast(queryId);\n    this.removeQuery(queryId);\n  };\n\n  QueryManager.prototype.removeQuery = function (queryId) {\n    this.fetchCancelFns.delete(queryId);\n\n    if (this.queries.has(queryId)) {\n      this.getQuery(queryId).stop();\n      this.queries.delete(queryId);\n    }\n  };\n\n  QueryManager.prototype.broadcastQueries = function () {\n    if (this.onBroadcast) this.onBroadcast();\n    this.queries.forEach(function (info) {\n      return info.notify();\n    });\n  };\n\n  QueryManager.prototype.getLocalState = function () {\n    return this.localState;\n  };\n\n  QueryManager.prototype.getObservableFromLink = function (query, context, variables, deduplication) {\n    var _this = this;\n\n    var _a;\n\n    if (deduplication === void 0) {\n      deduplication = (_a = context === null || context === void 0 ? void 0 : context.queryDeduplication) !== null && _a !== void 0 ? _a : this.queryDeduplication;\n    }\n\n    var observable;\n    var serverQuery = this.transform(query).serverQuery;\n\n    if (serverQuery) {\n      var _b = this,\n          inFlightLinkObservables_1 = _b.inFlightLinkObservables,\n          link = _b.link;\n\n      var operation = {\n        query: serverQuery,\n        variables: variables,\n        operationName: getOperationName(serverQuery) || void 0,\n        context: this.prepareContext(__assign(__assign({}, context), {\n          forceFetch: !deduplication\n        }))\n      };\n      context = operation.context;\n\n      if (deduplication) {\n        var byVariables_1 = inFlightLinkObservables_1.get(serverQuery) || new Map();\n        inFlightLinkObservables_1.set(serverQuery, byVariables_1);\n        var varJson_1 = canonicalStringify(variables);\n        observable = byVariables_1.get(varJson_1);\n\n        if (!observable) {\n          var concast = new Concast([execute(link, operation)]);\n          byVariables_1.set(varJson_1, observable = concast);\n          concast.beforeNext(function () {\n            if (byVariables_1.delete(varJson_1) && byVariables_1.size < 1) {\n              inFlightLinkObservables_1.delete(serverQuery);\n            }\n          });\n        }\n      } else {\n        observable = new Concast([execute(link, operation)]);\n      }\n    } else {\n      observable = new Concast([Observable.of({\n        data: {}\n      })]);\n      context = this.prepareContext(context);\n    }\n\n    var clientQuery = this.transform(query).clientQuery;\n\n    if (clientQuery) {\n      observable = asyncMap(observable, function (result) {\n        return _this.localState.runResolvers({\n          document: clientQuery,\n          remoteResult: result,\n          context: context,\n          variables: variables\n        });\n      });\n    }\n\n    return observable;\n  };\n\n  QueryManager.prototype.getResultsFromLink = function (queryInfo, cacheWriteBehavior, options) {\n    var requestId = queryInfo.lastRequestId = this.generateRequestId();\n    var linkDocument = this.cache.transformForLink(this.transform(queryInfo.document).document);\n    return asyncMap(this.getObservableFromLink(linkDocument, options.context, options.variables), function (result) {\n      var graphQLErrors = getGraphQLErrorsFromResult(result);\n      var hasErrors = graphQLErrors.length > 0;\n\n      if (requestId >= queryInfo.lastRequestId) {\n        if (hasErrors && options.errorPolicy === \"none\") {\n          throw queryInfo.markError(new ApolloError({\n            graphQLErrors: graphQLErrors\n          }));\n        }\n\n        queryInfo.markResult(result, linkDocument, options, cacheWriteBehavior);\n        queryInfo.markReady();\n      }\n\n      var aqr = {\n        data: result.data,\n        loading: false,\n        networkStatus: NetworkStatus.ready\n      };\n\n      if (hasErrors && options.errorPolicy !== \"ignore\") {\n        aqr.errors = graphQLErrors;\n        aqr.networkStatus = NetworkStatus.error;\n      }\n\n      return aqr;\n    }, function (networkError) {\n      var error = isApolloError(networkError) ? networkError : new ApolloError({\n        networkError: networkError\n      });\n\n      if (requestId >= queryInfo.lastRequestId) {\n        queryInfo.markError(error);\n      }\n\n      throw error;\n    });\n  };\n\n  QueryManager.prototype.fetchQueryObservable = function (queryId, options, networkStatus) {\n    var _this = this;\n\n    if (networkStatus === void 0) {\n      networkStatus = NetworkStatus.loading;\n    }\n\n    var query = this.transform(options.query).document;\n    var variables = this.getVariables(query, options.variables);\n    var queryInfo = this.getQuery(queryId);\n    var defaults = this.defaultOptions.watchQuery;\n    var _a = options.fetchPolicy,\n        fetchPolicy = _a === void 0 ? defaults && defaults.fetchPolicy || \"cache-first\" : _a,\n        _b = options.errorPolicy,\n        errorPolicy = _b === void 0 ? defaults && defaults.errorPolicy || \"none\" : _b,\n        _c = options.returnPartialData,\n        returnPartialData = _c === void 0 ? false : _c,\n        _d = options.notifyOnNetworkStatusChange,\n        notifyOnNetworkStatusChange = _d === void 0 ? false : _d,\n        _e = options.context,\n        context = _e === void 0 ? {} : _e;\n    var normalized = Object.assign({}, options, {\n      query: query,\n      variables: variables,\n      fetchPolicy: fetchPolicy,\n      errorPolicy: errorPolicy,\n      returnPartialData: returnPartialData,\n      notifyOnNetworkStatusChange: notifyOnNetworkStatusChange,\n      context: context\n    });\n\n    var fromVariables = function (variables) {\n      normalized.variables = variables;\n\n      var concastSources = _this.fetchQueryByPolicy(queryInfo, normalized, networkStatus);\n\n      if (normalized.fetchPolicy !== \"standby\" && concastSources.length > 0 && queryInfo.observableQuery) {\n        queryInfo.observableQuery[\"applyNextFetchPolicy\"](\"after-fetch\", options);\n      }\n\n      return concastSources;\n    };\n\n    var cleanupCancelFn = function () {\n      return _this.fetchCancelFns.delete(queryId);\n    };\n\n    this.fetchCancelFns.set(queryId, function (reason) {\n      cleanupCancelFn();\n      setTimeout(function () {\n        return concast.cancel(reason);\n      });\n    });\n    var concast = new Concast(this.transform(normalized.query).hasClientExports ? this.localState.addExportedVariables(normalized.query, normalized.variables, normalized.context).then(fromVariables) : fromVariables(normalized.variables));\n    concast.promise.then(cleanupCancelFn, cleanupCancelFn);\n    return concast;\n  };\n\n  QueryManager.prototype.refetchQueries = function (_a) {\n    var _this = this;\n\n    var updateCache = _a.updateCache,\n        include = _a.include,\n        _b = _a.optimistic,\n        optimistic = _b === void 0 ? false : _b,\n        _c = _a.removeOptimistic,\n        removeOptimistic = _c === void 0 ? optimistic ? makeUniqueId(\"refetchQueries\") : void 0 : _c,\n        onQueryUpdated = _a.onQueryUpdated;\n    var includedQueriesById = new Map();\n\n    if (include) {\n      this.getObservableQueries(include).forEach(function (oq, queryId) {\n        includedQueriesById.set(queryId, {\n          oq: oq,\n          lastDiff: _this.getQuery(queryId).getDiff()\n        });\n      });\n    }\n\n    var results = new Map();\n\n    if (updateCache) {\n      this.cache.batch({\n        update: updateCache,\n        optimistic: optimistic && removeOptimistic || false,\n        removeOptimistic: removeOptimistic,\n        onWatchUpdated: function (watch, diff, lastDiff) {\n          var oq = watch.watcher instanceof QueryInfo && watch.watcher.observableQuery;\n\n          if (oq) {\n            if (onQueryUpdated) {\n              includedQueriesById.delete(oq.queryId);\n              var result = onQueryUpdated(oq, diff, lastDiff);\n\n              if (result === true) {\n                result = oq.refetch();\n              }\n\n              if (result !== false) {\n                results.set(oq, result);\n              }\n\n              return result;\n            }\n\n            if (onQueryUpdated !== null) {\n              includedQueriesById.set(oq.queryId, {\n                oq: oq,\n                lastDiff: lastDiff,\n                diff: diff\n              });\n            }\n          }\n        }\n      });\n    }\n\n    if (includedQueriesById.size) {\n      includedQueriesById.forEach(function (_a, queryId) {\n        var oq = _a.oq,\n            lastDiff = _a.lastDiff,\n            diff = _a.diff;\n        var result;\n\n        if (onQueryUpdated) {\n          if (!diff) {\n            var info = oq[\"queryInfo\"];\n            info.reset();\n            diff = info.getDiff();\n          }\n\n          result = onQueryUpdated(oq, diff, lastDiff);\n        }\n\n        if (!onQueryUpdated || result === true) {\n          result = oq.refetch();\n        }\n\n        if (result !== false) {\n          results.set(oq, result);\n        }\n\n        if (queryId.indexOf(\"legacyOneTimeQuery\") >= 0) {\n          _this.stopQueryNoBroadcast(queryId);\n        }\n      });\n    }\n\n    if (removeOptimistic) {\n      this.cache.removeOptimistic(removeOptimistic);\n    }\n\n    return results;\n  };\n\n  QueryManager.prototype.fetchQueryByPolicy = function (queryInfo, _a, networkStatus) {\n    var _this = this;\n\n    var query = _a.query,\n        variables = _a.variables,\n        fetchPolicy = _a.fetchPolicy,\n        refetchWritePolicy = _a.refetchWritePolicy,\n        errorPolicy = _a.errorPolicy,\n        returnPartialData = _a.returnPartialData,\n        context = _a.context,\n        notifyOnNetworkStatusChange = _a.notifyOnNetworkStatusChange;\n    var oldNetworkStatus = queryInfo.networkStatus;\n    queryInfo.init({\n      document: this.transform(query).document,\n      variables: variables,\n      networkStatus: networkStatus\n    });\n\n    var readCache = function () {\n      return queryInfo.getDiff(variables);\n    };\n\n    var resultsFromCache = function (diff, networkStatus) {\n      if (networkStatus === void 0) {\n        networkStatus = queryInfo.networkStatus || NetworkStatus.loading;\n      }\n\n      var data = diff.result;\n\n      if (__DEV__ && !returnPartialData && !equal(data, {})) {\n        logMissingFieldErrors(diff.missing);\n      }\n\n      var fromData = function (data) {\n        return Observable.of(__assign({\n          data: data,\n          loading: isNetworkRequestInFlight(networkStatus),\n          networkStatus: networkStatus\n        }, diff.complete ? null : {\n          partial: true\n        }));\n      };\n\n      if (data && _this.transform(query).hasForcedResolvers) {\n        return _this.localState.runResolvers({\n          document: query,\n          remoteResult: {\n            data: data\n          },\n          context: context,\n          variables: variables,\n          onlyRunForcedResolvers: true\n        }).then(function (resolved) {\n          return fromData(resolved.data || void 0);\n        });\n      }\n\n      if (errorPolicy === 'none' && networkStatus === NetworkStatus.refetch && Array.isArray(diff.missing)) {\n        return fromData(void 0);\n      }\n\n      return fromData(data);\n    };\n\n    var cacheWriteBehavior = fetchPolicy === \"no-cache\" ? 0 : networkStatus === NetworkStatus.refetch && refetchWritePolicy !== \"merge\" ? 1 : 2;\n\n    var resultsFromLink = function () {\n      return _this.getResultsFromLink(queryInfo, cacheWriteBehavior, {\n        variables: variables,\n        context: context,\n        fetchPolicy: fetchPolicy,\n        errorPolicy: errorPolicy\n      });\n    };\n\n    var shouldNotify = notifyOnNetworkStatusChange && typeof oldNetworkStatus === \"number\" && oldNetworkStatus !== networkStatus && isNetworkRequestInFlight(networkStatus);\n\n    switch (fetchPolicy) {\n      default:\n      case \"cache-first\":\n        {\n          var diff = readCache();\n\n          if (diff.complete) {\n            return [resultsFromCache(diff, queryInfo.markReady())];\n          }\n\n          if (returnPartialData || shouldNotify) {\n            return [resultsFromCache(diff), resultsFromLink()];\n          }\n\n          return [resultsFromLink()];\n        }\n\n      case \"cache-and-network\":\n        {\n          var diff = readCache();\n\n          if (diff.complete || returnPartialData || shouldNotify) {\n            return [resultsFromCache(diff), resultsFromLink()];\n          }\n\n          return [resultsFromLink()];\n        }\n\n      case \"cache-only\":\n        return [resultsFromCache(readCache(), queryInfo.markReady())];\n\n      case \"network-only\":\n        if (shouldNotify) {\n          return [resultsFromCache(readCache()), resultsFromLink()];\n        }\n\n        return [resultsFromLink()];\n\n      case \"no-cache\":\n        if (shouldNotify) {\n          return [resultsFromCache(queryInfo.getDiff()), resultsFromLink()];\n        }\n\n        return [resultsFromLink()];\n\n      case \"standby\":\n        return [];\n    }\n  };\n\n  QueryManager.prototype.getQuery = function (queryId) {\n    if (queryId && !this.queries.has(queryId)) {\n      this.queries.set(queryId, new QueryInfo(this, queryId));\n    }\n\n    return this.queries.get(queryId);\n  };\n\n  QueryManager.prototype.prepareContext = function (context) {\n    if (context === void 0) {\n      context = {};\n    }\n\n    var newContext = this.localState.prepareContext(context);\n    return __assign(__assign({}, newContext), {\n      clientAwareness: this.clientAwareness\n    });\n  };\n\n  return QueryManager;\n}();\n\nexport { QueryManager };","map":{"version":3,"names":["__assign","__awaiter","__generator","invariant","InvariantError","equal","execute","isExecutionPatchIncrementalResult","isExecutionPatchResult","canonicalStringify","getDefaultValues","getOperationDefinition","getOperationName","hasClientExports","graphQLResultHasError","getGraphQLErrorsFromResult","removeConnectionDirectiveFromDocument","canUseWeakMap","Observable","asyncMap","isNonEmptyArray","Concast","makeUniqueId","isDocumentNode","isNonNullObject","mergeIncrementalData","ApolloError","isApolloError","ObservableQuery","logMissingFieldErrors","NetworkStatus","isNetworkRequestInFlight","LocalState","QueryInfo","shouldWriteResult","hasOwnProperty","Object","prototype","QueryManager","_a","cache","link","defaultOptions","_b","queryDeduplication","onBroadcast","_c","ssrMode","_d","clientAwareness","localState","assumeImmutableResults","queries","Map","fetchCancelFns","transformCache","WeakMap","queryIdCounter","requestIdCounter","mutationIdCounter","inFlightLinkObservables","create","mutationStore","stop","_this","forEach","_info","queryId","stopQueryNoBroadcast","cancelPendingFetches","__DEV__","error","cancel","clear","mutate","mutation","variables","optimisticResponse","updateQueries","refetchQueries","_e","awaitRefetchQueries","updateWithProxyFn","update","onQueryUpdated","_f","fetchPolicy","_g","errorPolicy","keepRootFields","context","mutationId","_h","document","mutationStoreValue","self","_j","label","generateMutationId","transform","transformForLink","getVariables","addExportedVariables","sent","loading","markMutationOptimistic","broadcastQueries","Promise","resolve","reject","getObservableFromLink","result","graphQLErrors","storeResult","errors","markMutationResult","removeOptimistic","subscribe","next","hasNext","err","networkError","cacheWrites","skipCache","push","data","dataId","query","incremental","diff","id","asQuery","optimistic","returnPartialData","mergedData","updateQueries_1","observableQuery","queryName","call","updater","get","currentQueryResult","complete","nextQueryResult","mutationResult","queryVariables","length","results_1","updateCache","write","isFinalResult","modify","fields","value","fieldName","DELETE","include","all","then","recordOptimisticTransaction","fetchQuery","options","networkStatus","fetchQueryObservable","promise","getQueryStore","store","info","resetErrors","queryInfo","undefined","has","transformed","transformDocument","noConnection","clientQuery","serverQuery","cacheEntry_1","hasForcedResolvers","shouldForceResolvers","defaultVars","definitions","map","def","kind","operation","add","doc","set","watchQuery","notifyOnNetworkStatusChange","observable","queryManager","init","generateQueryId","pollInterval","finally","stopQuery","String","generateRequestId","stopQueryInStore","stopQueryInStoreNoBroadcast","clearStore","discardWatches","reset","getObservableQueries","queryNamesAndDocs","legacyQueryOptions","Set","Array","isArray","desc","oq","hasObservers","size","getQuery","setObservableQuery","included","nameOrDoc","warn","concat","JSON","stringify","reFetchObservableQueries","includeStandby","observableQueryPromises","resetLastResults","refetch","setDiff","startGraphQLSubscription","makeObservable","observablePromise_1","observer","sub","unsubscribe","removeQuery","delete","notify","getLocalState","deduplication","inFlightLinkObservables_1","operationName","prepareContext","forceFetch","byVariables_1","varJson_1","concast","beforeNext","of","runResolvers","remoteResult","getResultsFromLink","cacheWriteBehavior","requestId","lastRequestId","linkDocument","hasErrors","markError","markResult","markReady","aqr","ready","defaults","normalized","assign","fromVariables","concastSources","fetchQueryByPolicy","cleanupCancelFn","reason","setTimeout","includedQueriesById","lastDiff","getDiff","results","batch","onWatchUpdated","watch","watcher","indexOf","refetchWritePolicy","oldNetworkStatus","readCache","resultsFromCache","missing","fromData","partial","onlyRunForcedResolvers","resolved","resultsFromLink","shouldNotify","newContext"],"sources":["F:/Bureau/Test_MachinesTalk/MachinesTalk/node_modules/@apollo/client/core/QueryManager.js"],"sourcesContent":["import { __assign, __awaiter, __generator } from \"tslib\";\nimport { invariant, InvariantError } from \"../utilities/globals/index.js\";\nimport { equal } from '@wry/equality';\nimport { execute } from \"../link/core/index.js\";\nimport { isExecutionPatchIncrementalResult, isExecutionPatchResult, } from \"../utilities/common/incrementalResult.js\";\nimport { canonicalStringify } from \"../cache/index.js\";\nimport { getDefaultValues, getOperationDefinition, getOperationName, hasClientExports, graphQLResultHasError, getGraphQLErrorsFromResult, removeConnectionDirectiveFromDocument, canUseWeakMap, Observable, asyncMap, isNonEmptyArray, Concast, makeUniqueId, isDocumentNode, isNonNullObject, } from \"../utilities/index.js\";\nimport { mergeIncrementalData } from \"../utilities/common/incrementalResult.js\";\nimport { ApolloError, isApolloError } from \"../errors/index.js\";\nimport { ObservableQuery, logMissingFieldErrors } from \"./ObservableQuery.js\";\nimport { NetworkStatus, isNetworkRequestInFlight } from \"./networkStatus.js\";\nimport { LocalState } from \"./LocalState.js\";\nimport { QueryInfo, shouldWriteResult, } from \"./QueryInfo.js\";\nvar hasOwnProperty = Object.prototype.hasOwnProperty;\nvar QueryManager = (function () {\n    function QueryManager(_a) {\n        var cache = _a.cache, link = _a.link, defaultOptions = _a.defaultOptions, _b = _a.queryDeduplication, queryDeduplication = _b === void 0 ? false : _b, onBroadcast = _a.onBroadcast, _c = _a.ssrMode, ssrMode = _c === void 0 ? false : _c, _d = _a.clientAwareness, clientAwareness = _d === void 0 ? {} : _d, localState = _a.localState, assumeImmutableResults = _a.assumeImmutableResults;\n        this.clientAwareness = {};\n        this.queries = new Map();\n        this.fetchCancelFns = new Map();\n        this.transformCache = new (canUseWeakMap ? WeakMap : Map)();\n        this.queryIdCounter = 1;\n        this.requestIdCounter = 1;\n        this.mutationIdCounter = 1;\n        this.inFlightLinkObservables = new Map();\n        this.cache = cache;\n        this.link = link;\n        this.defaultOptions = defaultOptions || Object.create(null);\n        this.queryDeduplication = queryDeduplication;\n        this.clientAwareness = clientAwareness;\n        this.localState = localState || new LocalState({ cache: cache });\n        this.ssrMode = ssrMode;\n        this.assumeImmutableResults = !!assumeImmutableResults;\n        if ((this.onBroadcast = onBroadcast)) {\n            this.mutationStore = Object.create(null);\n        }\n    }\n    QueryManager.prototype.stop = function () {\n        var _this = this;\n        this.queries.forEach(function (_info, queryId) {\n            _this.stopQueryNoBroadcast(queryId);\n        });\n        this.cancelPendingFetches(__DEV__ ? new InvariantError('QueryManager stopped while query was in flight') : new InvariantError(13));\n    };\n    QueryManager.prototype.cancelPendingFetches = function (error) {\n        this.fetchCancelFns.forEach(function (cancel) { return cancel(error); });\n        this.fetchCancelFns.clear();\n    };\n    QueryManager.prototype.mutate = function (_a) {\n        var _b, _c;\n        var mutation = _a.mutation, variables = _a.variables, optimisticResponse = _a.optimisticResponse, updateQueries = _a.updateQueries, _d = _a.refetchQueries, refetchQueries = _d === void 0 ? [] : _d, _e = _a.awaitRefetchQueries, awaitRefetchQueries = _e === void 0 ? false : _e, updateWithProxyFn = _a.update, onQueryUpdated = _a.onQueryUpdated, _f = _a.fetchPolicy, fetchPolicy = _f === void 0 ? ((_b = this.defaultOptions.mutate) === null || _b === void 0 ? void 0 : _b.fetchPolicy) || \"network-only\" : _f, _g = _a.errorPolicy, errorPolicy = _g === void 0 ? ((_c = this.defaultOptions.mutate) === null || _c === void 0 ? void 0 : _c.errorPolicy) || \"none\" : _g, keepRootFields = _a.keepRootFields, context = _a.context;\n        return __awaiter(this, void 0, void 0, function () {\n            var mutationId, _h, document, hasClientExports, mutationStoreValue, self;\n            return __generator(this, function (_j) {\n                switch (_j.label) {\n                    case 0:\n                        __DEV__ ? invariant(mutation, 'mutation option is required. You must specify your GraphQL document in the mutation option.') : invariant(mutation, 14);\n                        __DEV__ ? invariant(fetchPolicy === 'network-only' ||\n                            fetchPolicy === 'no-cache', \"Mutations support only 'network-only' or 'no-cache' fetchPolicy strings. The default `network-only` behavior automatically writes mutation results to the cache. Passing `no-cache` skips the cache write.\") : invariant(fetchPolicy === 'network-only' ||\n                            fetchPolicy === 'no-cache', 15);\n                        mutationId = this.generateMutationId();\n                        _h = this.transform(mutation), document = _h.document, hasClientExports = _h.hasClientExports;\n                        mutation = this.cache.transformForLink(document);\n                        variables = this.getVariables(mutation, variables);\n                        if (!hasClientExports) return [3, 2];\n                        return [4, this.localState.addExportedVariables(mutation, variables, context)];\n                    case 1:\n                        variables = (_j.sent());\n                        _j.label = 2;\n                    case 2:\n                        mutationStoreValue = this.mutationStore &&\n                            (this.mutationStore[mutationId] = {\n                                mutation: mutation,\n                                variables: variables,\n                                loading: true,\n                                error: null,\n                            });\n                        if (optimisticResponse) {\n                            this.markMutationOptimistic(optimisticResponse, {\n                                mutationId: mutationId,\n                                document: mutation,\n                                variables: variables,\n                                fetchPolicy: fetchPolicy,\n                                errorPolicy: errorPolicy,\n                                context: context,\n                                updateQueries: updateQueries,\n                                update: updateWithProxyFn,\n                                keepRootFields: keepRootFields,\n                            });\n                        }\n                        this.broadcastQueries();\n                        self = this;\n                        return [2, new Promise(function (resolve, reject) {\n                                return asyncMap(self.getObservableFromLink(mutation, __assign(__assign({}, context), { optimisticResponse: optimisticResponse }), variables, false), function (result) {\n                                    if (graphQLResultHasError(result) && errorPolicy === 'none') {\n                                        throw new ApolloError({\n                                            graphQLErrors: getGraphQLErrorsFromResult(result),\n                                        });\n                                    }\n                                    if (mutationStoreValue) {\n                                        mutationStoreValue.loading = false;\n                                        mutationStoreValue.error = null;\n                                    }\n                                    var storeResult = __assign({}, result);\n                                    if (typeof refetchQueries === \"function\") {\n                                        refetchQueries = refetchQueries(storeResult);\n                                    }\n                                    if (errorPolicy === 'ignore' &&\n                                        graphQLResultHasError(storeResult)) {\n                                        delete storeResult.errors;\n                                    }\n                                    return self.markMutationResult({\n                                        mutationId: mutationId,\n                                        result: storeResult,\n                                        document: mutation,\n                                        variables: variables,\n                                        fetchPolicy: fetchPolicy,\n                                        errorPolicy: errorPolicy,\n                                        context: context,\n                                        update: updateWithProxyFn,\n                                        updateQueries: updateQueries,\n                                        awaitRefetchQueries: awaitRefetchQueries,\n                                        refetchQueries: refetchQueries,\n                                        removeOptimistic: optimisticResponse ? mutationId : void 0,\n                                        onQueryUpdated: onQueryUpdated,\n                                        keepRootFields: keepRootFields,\n                                    });\n                                }).subscribe({\n                                    next: function (storeResult) {\n                                        self.broadcastQueries();\n                                        if (!('hasNext' in storeResult) || storeResult.hasNext === false) {\n                                            resolve(storeResult);\n                                        }\n                                    },\n                                    error: function (err) {\n                                        if (mutationStoreValue) {\n                                            mutationStoreValue.loading = false;\n                                            mutationStoreValue.error = err;\n                                        }\n                                        if (optimisticResponse) {\n                                            self.cache.removeOptimistic(mutationId);\n                                        }\n                                        self.broadcastQueries();\n                                        reject(err instanceof ApolloError ? err : new ApolloError({\n                                            networkError: err,\n                                        }));\n                                    },\n                                });\n                            })];\n                }\n            });\n        });\n    };\n    QueryManager.prototype.markMutationResult = function (mutation, cache) {\n        var _this = this;\n        if (cache === void 0) { cache = this.cache; }\n        var result = mutation.result;\n        var cacheWrites = [];\n        var skipCache = mutation.fetchPolicy === \"no-cache\";\n        if (!skipCache && shouldWriteResult(result, mutation.errorPolicy)) {\n            if (!isExecutionPatchIncrementalResult(result)) {\n                cacheWrites.push({\n                    result: result.data,\n                    dataId: 'ROOT_MUTATION',\n                    query: mutation.document,\n                    variables: mutation.variables,\n                });\n            }\n            if (isExecutionPatchIncrementalResult(result) && isNonEmptyArray(result.incremental)) {\n                var diff = cache.diff({\n                    id: \"ROOT_MUTATION\",\n                    query: this.transform(mutation.document).asQuery,\n                    variables: mutation.variables,\n                    optimistic: false,\n                    returnPartialData: true,\n                });\n                var mergedData = mergeIncrementalData(diff.result, result);\n                if (typeof mergedData !== 'undefined') {\n                    result.data = mergedData;\n                    cacheWrites.push({\n                        result: mergedData,\n                        dataId: 'ROOT_MUTATION',\n                        query: mutation.document,\n                        variables: mutation.variables,\n                    });\n                }\n            }\n            var updateQueries_1 = mutation.updateQueries;\n            if (updateQueries_1) {\n                this.queries.forEach(function (_a, queryId) {\n                    var observableQuery = _a.observableQuery;\n                    var queryName = observableQuery && observableQuery.queryName;\n                    if (!queryName || !hasOwnProperty.call(updateQueries_1, queryName)) {\n                        return;\n                    }\n                    var updater = updateQueries_1[queryName];\n                    var _b = _this.queries.get(queryId), document = _b.document, variables = _b.variables;\n                    var _c = cache.diff({\n                        query: document,\n                        variables: variables,\n                        returnPartialData: true,\n                        optimistic: false,\n                    }), currentQueryResult = _c.result, complete = _c.complete;\n                    if (complete && currentQueryResult) {\n                        var nextQueryResult = updater(currentQueryResult, {\n                            mutationResult: result,\n                            queryName: document && getOperationName(document) || void 0,\n                            queryVariables: variables,\n                        });\n                        if (nextQueryResult) {\n                            cacheWrites.push({\n                                result: nextQueryResult,\n                                dataId: 'ROOT_QUERY',\n                                query: document,\n                                variables: variables,\n                            });\n                        }\n                    }\n                });\n            }\n        }\n        if (cacheWrites.length > 0 ||\n            mutation.refetchQueries ||\n            mutation.update ||\n            mutation.onQueryUpdated ||\n            mutation.removeOptimistic) {\n            var results_1 = [];\n            this.refetchQueries({\n                updateCache: function (cache) {\n                    if (!skipCache) {\n                        cacheWrites.forEach(function (write) { return cache.write(write); });\n                    }\n                    var update = mutation.update;\n                    var isFinalResult = !isExecutionPatchResult(result) ||\n                        (isExecutionPatchIncrementalResult(result) && !result.hasNext);\n                    if (update) {\n                        if (!skipCache) {\n                            var diff = cache.diff({\n                                id: \"ROOT_MUTATION\",\n                                query: _this.transform(mutation.document).asQuery,\n                                variables: mutation.variables,\n                                optimistic: false,\n                                returnPartialData: true,\n                            });\n                            if (diff.complete) {\n                                result = __assign(__assign({}, result), { data: diff.result });\n                                if ('incremental' in result) {\n                                    delete result.incremental;\n                                }\n                                if ('hasNext' in result) {\n                                    delete result.hasNext;\n                                }\n                            }\n                        }\n                        if (isFinalResult) {\n                            update(cache, result, {\n                                context: mutation.context,\n                                variables: mutation.variables,\n                            });\n                        }\n                    }\n                    if (!skipCache && !mutation.keepRootFields && isFinalResult) {\n                        cache.modify({\n                            id: 'ROOT_MUTATION',\n                            fields: function (value, _a) {\n                                var fieldName = _a.fieldName, DELETE = _a.DELETE;\n                                return fieldName === \"__typename\" ? value : DELETE;\n                            },\n                        });\n                    }\n                },\n                include: mutation.refetchQueries,\n                optimistic: false,\n                removeOptimistic: mutation.removeOptimistic,\n                onQueryUpdated: mutation.onQueryUpdated || null,\n            }).forEach(function (result) { return results_1.push(result); });\n            if (mutation.awaitRefetchQueries || mutation.onQueryUpdated) {\n                return Promise.all(results_1).then(function () { return result; });\n            }\n        }\n        return Promise.resolve(result);\n    };\n    QueryManager.prototype.markMutationOptimistic = function (optimisticResponse, mutation) {\n        var _this = this;\n        var data = typeof optimisticResponse === \"function\"\n            ? optimisticResponse(mutation.variables)\n            : optimisticResponse;\n        return this.cache.recordOptimisticTransaction(function (cache) {\n            try {\n                _this.markMutationResult(__assign(__assign({}, mutation), { result: { data: data } }), cache);\n            }\n            catch (error) {\n                __DEV__ && invariant.error(error);\n            }\n        }, mutation.mutationId);\n    };\n    QueryManager.prototype.fetchQuery = function (queryId, options, networkStatus) {\n        return this.fetchQueryObservable(queryId, options, networkStatus).promise;\n    };\n    QueryManager.prototype.getQueryStore = function () {\n        var store = Object.create(null);\n        this.queries.forEach(function (info, queryId) {\n            store[queryId] = {\n                variables: info.variables,\n                networkStatus: info.networkStatus,\n                networkError: info.networkError,\n                graphQLErrors: info.graphQLErrors,\n            };\n        });\n        return store;\n    };\n    QueryManager.prototype.resetErrors = function (queryId) {\n        var queryInfo = this.queries.get(queryId);\n        if (queryInfo) {\n            queryInfo.networkError = undefined;\n            queryInfo.graphQLErrors = [];\n        }\n    };\n    QueryManager.prototype.transform = function (document) {\n        var transformCache = this.transformCache;\n        if (!transformCache.has(document)) {\n            var transformed = this.cache.transformDocument(document);\n            var noConnection = removeConnectionDirectiveFromDocument(transformed);\n            var clientQuery = this.localState.clientQuery(transformed);\n            var serverQuery = noConnection && this.localState.serverQuery(noConnection);\n            var cacheEntry_1 = {\n                document: transformed,\n                hasClientExports: hasClientExports(transformed),\n                hasForcedResolvers: this.localState.shouldForceResolvers(transformed),\n                clientQuery: clientQuery,\n                serverQuery: serverQuery,\n                defaultVars: getDefaultValues(getOperationDefinition(transformed)),\n                asQuery: __assign(__assign({}, transformed), { definitions: transformed.definitions.map(function (def) {\n                        if (def.kind === \"OperationDefinition\" &&\n                            def.operation !== \"query\") {\n                            return __assign(__assign({}, def), { operation: \"query\" });\n                        }\n                        return def;\n                    }) })\n            };\n            var add = function (doc) {\n                if (doc && !transformCache.has(doc)) {\n                    transformCache.set(doc, cacheEntry_1);\n                }\n            };\n            add(document);\n            add(transformed);\n            add(clientQuery);\n            add(serverQuery);\n        }\n        return transformCache.get(document);\n    };\n    QueryManager.prototype.getVariables = function (document, variables) {\n        return __assign(__assign({}, this.transform(document).defaultVars), variables);\n    };\n    QueryManager.prototype.watchQuery = function (options) {\n        options = __assign(__assign({}, options), { variables: this.getVariables(options.query, options.variables) });\n        if (typeof options.notifyOnNetworkStatusChange === 'undefined') {\n            options.notifyOnNetworkStatusChange = false;\n        }\n        var queryInfo = new QueryInfo(this);\n        var observable = new ObservableQuery({\n            queryManager: this,\n            queryInfo: queryInfo,\n            options: options,\n        });\n        this.queries.set(observable.queryId, queryInfo);\n        queryInfo.init({\n            document: observable.query,\n            observableQuery: observable,\n            variables: observable.variables,\n        });\n        return observable;\n    };\n    QueryManager.prototype.query = function (options, queryId) {\n        var _this = this;\n        if (queryId === void 0) { queryId = this.generateQueryId(); }\n        __DEV__ ? invariant(options.query, 'query option is required. You must specify your GraphQL document ' +\n            'in the query option.') : invariant(options.query, 16);\n        __DEV__ ? invariant(options.query.kind === 'Document', 'You must wrap the query string in a \"gql\" tag.') : invariant(options.query.kind === 'Document', 17);\n        __DEV__ ? invariant(!options.returnPartialData, 'returnPartialData option only supported on watchQuery.') : invariant(!options.returnPartialData, 18);\n        __DEV__ ? invariant(!options.pollInterval, 'pollInterval option only supported on watchQuery.') : invariant(!options.pollInterval, 19);\n        return this.fetchQuery(queryId, options).finally(function () { return _this.stopQuery(queryId); });\n    };\n    QueryManager.prototype.generateQueryId = function () {\n        return String(this.queryIdCounter++);\n    };\n    QueryManager.prototype.generateRequestId = function () {\n        return this.requestIdCounter++;\n    };\n    QueryManager.prototype.generateMutationId = function () {\n        return String(this.mutationIdCounter++);\n    };\n    QueryManager.prototype.stopQueryInStore = function (queryId) {\n        this.stopQueryInStoreNoBroadcast(queryId);\n        this.broadcastQueries();\n    };\n    QueryManager.prototype.stopQueryInStoreNoBroadcast = function (queryId) {\n        var queryInfo = this.queries.get(queryId);\n        if (queryInfo)\n            queryInfo.stop();\n    };\n    QueryManager.prototype.clearStore = function (options) {\n        if (options === void 0) { options = {\n            discardWatches: true,\n        }; }\n        this.cancelPendingFetches(__DEV__ ? new InvariantError('Store reset while query was in flight (not completed in link chain)') : new InvariantError(20));\n        this.queries.forEach(function (queryInfo) {\n            if (queryInfo.observableQuery) {\n                queryInfo.networkStatus = NetworkStatus.loading;\n            }\n            else {\n                queryInfo.stop();\n            }\n        });\n        if (this.mutationStore) {\n            this.mutationStore = Object.create(null);\n        }\n        return this.cache.reset(options);\n    };\n    QueryManager.prototype.getObservableQueries = function (include) {\n        var _this = this;\n        if (include === void 0) { include = \"active\"; }\n        var queries = new Map();\n        var queryNamesAndDocs = new Map();\n        var legacyQueryOptions = new Set();\n        if (Array.isArray(include)) {\n            include.forEach(function (desc) {\n                if (typeof desc === \"string\") {\n                    queryNamesAndDocs.set(desc, false);\n                }\n                else if (isDocumentNode(desc)) {\n                    queryNamesAndDocs.set(_this.transform(desc).document, false);\n                }\n                else if (isNonNullObject(desc) && desc.query) {\n                    legacyQueryOptions.add(desc);\n                }\n            });\n        }\n        this.queries.forEach(function (_a, queryId) {\n            var oq = _a.observableQuery, document = _a.document;\n            if (oq) {\n                if (include === \"all\") {\n                    queries.set(queryId, oq);\n                    return;\n                }\n                var queryName = oq.queryName, fetchPolicy = oq.options.fetchPolicy;\n                if (fetchPolicy === \"standby\" ||\n                    (include === \"active\" && !oq.hasObservers())) {\n                    return;\n                }\n                if (include === \"active\" ||\n                    (queryName && queryNamesAndDocs.has(queryName)) ||\n                    (document && queryNamesAndDocs.has(document))) {\n                    queries.set(queryId, oq);\n                    if (queryName)\n                        queryNamesAndDocs.set(queryName, true);\n                    if (document)\n                        queryNamesAndDocs.set(document, true);\n                }\n            }\n        });\n        if (legacyQueryOptions.size) {\n            legacyQueryOptions.forEach(function (options) {\n                var queryId = makeUniqueId(\"legacyOneTimeQuery\");\n                var queryInfo = _this.getQuery(queryId).init({\n                    document: options.query,\n                    variables: options.variables,\n                });\n                var oq = new ObservableQuery({\n                    queryManager: _this,\n                    queryInfo: queryInfo,\n                    options: __assign(__assign({}, options), { fetchPolicy: \"network-only\" }),\n                });\n                invariant(oq.queryId === queryId);\n                queryInfo.setObservableQuery(oq);\n                queries.set(queryId, oq);\n            });\n        }\n        if (__DEV__ && queryNamesAndDocs.size) {\n            queryNamesAndDocs.forEach(function (included, nameOrDoc) {\n                if (!included) {\n                    __DEV__ && invariant.warn(\"Unknown query \".concat(typeof nameOrDoc === \"string\" ? \"named \" : \"\").concat(JSON.stringify(nameOrDoc, null, 2), \" requested in refetchQueries options.include array\"));\n                }\n            });\n        }\n        return queries;\n    };\n    QueryManager.prototype.reFetchObservableQueries = function (includeStandby) {\n        var _this = this;\n        if (includeStandby === void 0) { includeStandby = false; }\n        var observableQueryPromises = [];\n        this.getObservableQueries(includeStandby ? \"all\" : \"active\").forEach(function (observableQuery, queryId) {\n            var fetchPolicy = observableQuery.options.fetchPolicy;\n            observableQuery.resetLastResults();\n            if (includeStandby ||\n                (fetchPolicy !== \"standby\" &&\n                    fetchPolicy !== \"cache-only\")) {\n                observableQueryPromises.push(observableQuery.refetch());\n            }\n            _this.getQuery(queryId).setDiff(null);\n        });\n        this.broadcastQueries();\n        return Promise.all(observableQueryPromises);\n    };\n    QueryManager.prototype.setObservableQuery = function (observableQuery) {\n        this.getQuery(observableQuery.queryId).setObservableQuery(observableQuery);\n    };\n    QueryManager.prototype.startGraphQLSubscription = function (_a) {\n        var _this = this;\n        var query = _a.query, fetchPolicy = _a.fetchPolicy, errorPolicy = _a.errorPolicy, variables = _a.variables, _b = _a.context, context = _b === void 0 ? {} : _b;\n        query = this.transform(query).document;\n        variables = this.getVariables(query, variables);\n        var makeObservable = function (variables) {\n            return _this.getObservableFromLink(query, context, variables).map(function (result) {\n                if (fetchPolicy !== 'no-cache') {\n                    if (shouldWriteResult(result, errorPolicy)) {\n                        _this.cache.write({\n                            query: query,\n                            result: result.data,\n                            dataId: 'ROOT_SUBSCRIPTION',\n                            variables: variables,\n                        });\n                    }\n                    _this.broadcastQueries();\n                }\n                if (graphQLResultHasError(result)) {\n                    throw new ApolloError({\n                        graphQLErrors: result.errors,\n                    });\n                }\n                return result;\n            });\n        };\n        if (this.transform(query).hasClientExports) {\n            var observablePromise_1 = this.localState.addExportedVariables(query, variables, context).then(makeObservable);\n            return new Observable(function (observer) {\n                var sub = null;\n                observablePromise_1.then(function (observable) { return sub = observable.subscribe(observer); }, observer.error);\n                return function () { return sub && sub.unsubscribe(); };\n            });\n        }\n        return makeObservable(variables);\n    };\n    QueryManager.prototype.stopQuery = function (queryId) {\n        this.stopQueryNoBroadcast(queryId);\n        this.broadcastQueries();\n    };\n    QueryManager.prototype.stopQueryNoBroadcast = function (queryId) {\n        this.stopQueryInStoreNoBroadcast(queryId);\n        this.removeQuery(queryId);\n    };\n    QueryManager.prototype.removeQuery = function (queryId) {\n        this.fetchCancelFns.delete(queryId);\n        if (this.queries.has(queryId)) {\n            this.getQuery(queryId).stop();\n            this.queries.delete(queryId);\n        }\n    };\n    QueryManager.prototype.broadcastQueries = function () {\n        if (this.onBroadcast)\n            this.onBroadcast();\n        this.queries.forEach(function (info) { return info.notify(); });\n    };\n    QueryManager.prototype.getLocalState = function () {\n        return this.localState;\n    };\n    QueryManager.prototype.getObservableFromLink = function (query, context, variables, deduplication) {\n        var _this = this;\n        var _a;\n        if (deduplication === void 0) { deduplication = (_a = context === null || context === void 0 ? void 0 : context.queryDeduplication) !== null && _a !== void 0 ? _a : this.queryDeduplication; }\n        var observable;\n        var serverQuery = this.transform(query).serverQuery;\n        if (serverQuery) {\n            var _b = this, inFlightLinkObservables_1 = _b.inFlightLinkObservables, link = _b.link;\n            var operation = {\n                query: serverQuery,\n                variables: variables,\n                operationName: getOperationName(serverQuery) || void 0,\n                context: this.prepareContext(__assign(__assign({}, context), { forceFetch: !deduplication })),\n            };\n            context = operation.context;\n            if (deduplication) {\n                var byVariables_1 = inFlightLinkObservables_1.get(serverQuery) || new Map();\n                inFlightLinkObservables_1.set(serverQuery, byVariables_1);\n                var varJson_1 = canonicalStringify(variables);\n                observable = byVariables_1.get(varJson_1);\n                if (!observable) {\n                    var concast = new Concast([\n                        execute(link, operation)\n                    ]);\n                    byVariables_1.set(varJson_1, observable = concast);\n                    concast.beforeNext(function () {\n                        if (byVariables_1.delete(varJson_1) &&\n                            byVariables_1.size < 1) {\n                            inFlightLinkObservables_1.delete(serverQuery);\n                        }\n                    });\n                }\n            }\n            else {\n                observable = new Concast([\n                    execute(link, operation)\n                ]);\n            }\n        }\n        else {\n            observable = new Concast([\n                Observable.of({ data: {} })\n            ]);\n            context = this.prepareContext(context);\n        }\n        var clientQuery = this.transform(query).clientQuery;\n        if (clientQuery) {\n            observable = asyncMap(observable, function (result) {\n                return _this.localState.runResolvers({\n                    document: clientQuery,\n                    remoteResult: result,\n                    context: context,\n                    variables: variables,\n                });\n            });\n        }\n        return observable;\n    };\n    QueryManager.prototype.getResultsFromLink = function (queryInfo, cacheWriteBehavior, options) {\n        var requestId = queryInfo.lastRequestId = this.generateRequestId();\n        var linkDocument = this.cache.transformForLink(this.transform(queryInfo.document).document);\n        return asyncMap(this.getObservableFromLink(linkDocument, options.context, options.variables), function (result) {\n            var graphQLErrors = getGraphQLErrorsFromResult(result);\n            var hasErrors = graphQLErrors.length > 0;\n            if (requestId >= queryInfo.lastRequestId) {\n                if (hasErrors && options.errorPolicy === \"none\") {\n                    throw queryInfo.markError(new ApolloError({\n                        graphQLErrors: graphQLErrors,\n                    }));\n                }\n                queryInfo.markResult(result, linkDocument, options, cacheWriteBehavior);\n                queryInfo.markReady();\n            }\n            var aqr = {\n                data: result.data,\n                loading: false,\n                networkStatus: NetworkStatus.ready,\n            };\n            if (hasErrors && options.errorPolicy !== \"ignore\") {\n                aqr.errors = graphQLErrors;\n                aqr.networkStatus = NetworkStatus.error;\n            }\n            return aqr;\n        }, function (networkError) {\n            var error = isApolloError(networkError)\n                ? networkError\n                : new ApolloError({ networkError: networkError });\n            if (requestId >= queryInfo.lastRequestId) {\n                queryInfo.markError(error);\n            }\n            throw error;\n        });\n    };\n    QueryManager.prototype.fetchQueryObservable = function (queryId, options, networkStatus) {\n        var _this = this;\n        if (networkStatus === void 0) { networkStatus = NetworkStatus.loading; }\n        var query = this.transform(options.query).document;\n        var variables = this.getVariables(query, options.variables);\n        var queryInfo = this.getQuery(queryId);\n        var defaults = this.defaultOptions.watchQuery;\n        var _a = options.fetchPolicy, fetchPolicy = _a === void 0 ? defaults && defaults.fetchPolicy || \"cache-first\" : _a, _b = options.errorPolicy, errorPolicy = _b === void 0 ? defaults && defaults.errorPolicy || \"none\" : _b, _c = options.returnPartialData, returnPartialData = _c === void 0 ? false : _c, _d = options.notifyOnNetworkStatusChange, notifyOnNetworkStatusChange = _d === void 0 ? false : _d, _e = options.context, context = _e === void 0 ? {} : _e;\n        var normalized = Object.assign({}, options, {\n            query: query,\n            variables: variables,\n            fetchPolicy: fetchPolicy,\n            errorPolicy: errorPolicy,\n            returnPartialData: returnPartialData,\n            notifyOnNetworkStatusChange: notifyOnNetworkStatusChange,\n            context: context,\n        });\n        var fromVariables = function (variables) {\n            normalized.variables = variables;\n            var concastSources = _this.fetchQueryByPolicy(queryInfo, normalized, networkStatus);\n            if (normalized.fetchPolicy !== \"standby\" &&\n                concastSources.length > 0 &&\n                queryInfo.observableQuery) {\n                queryInfo.observableQuery[\"applyNextFetchPolicy\"](\"after-fetch\", options);\n            }\n            return concastSources;\n        };\n        var cleanupCancelFn = function () { return _this.fetchCancelFns.delete(queryId); };\n        this.fetchCancelFns.set(queryId, function (reason) {\n            cleanupCancelFn();\n            setTimeout(function () { return concast.cancel(reason); });\n        });\n        var concast = new Concast(this.transform(normalized.query).hasClientExports\n            ? this.localState.addExportedVariables(normalized.query, normalized.variables, normalized.context).then(fromVariables)\n            : fromVariables(normalized.variables));\n        concast.promise.then(cleanupCancelFn, cleanupCancelFn);\n        return concast;\n    };\n    QueryManager.prototype.refetchQueries = function (_a) {\n        var _this = this;\n        var updateCache = _a.updateCache, include = _a.include, _b = _a.optimistic, optimistic = _b === void 0 ? false : _b, _c = _a.removeOptimistic, removeOptimistic = _c === void 0 ? optimistic ? makeUniqueId(\"refetchQueries\") : void 0 : _c, onQueryUpdated = _a.onQueryUpdated;\n        var includedQueriesById = new Map();\n        if (include) {\n            this.getObservableQueries(include).forEach(function (oq, queryId) {\n                includedQueriesById.set(queryId, {\n                    oq: oq,\n                    lastDiff: _this.getQuery(queryId).getDiff(),\n                });\n            });\n        }\n        var results = new Map;\n        if (updateCache) {\n            this.cache.batch({\n                update: updateCache,\n                optimistic: optimistic && removeOptimistic || false,\n                removeOptimistic: removeOptimistic,\n                onWatchUpdated: function (watch, diff, lastDiff) {\n                    var oq = watch.watcher instanceof QueryInfo &&\n                        watch.watcher.observableQuery;\n                    if (oq) {\n                        if (onQueryUpdated) {\n                            includedQueriesById.delete(oq.queryId);\n                            var result = onQueryUpdated(oq, diff, lastDiff);\n                            if (result === true) {\n                                result = oq.refetch();\n                            }\n                            if (result !== false) {\n                                results.set(oq, result);\n                            }\n                            return result;\n                        }\n                        if (onQueryUpdated !== null) {\n                            includedQueriesById.set(oq.queryId, { oq: oq, lastDiff: lastDiff, diff: diff });\n                        }\n                    }\n                },\n            });\n        }\n        if (includedQueriesById.size) {\n            includedQueriesById.forEach(function (_a, queryId) {\n                var oq = _a.oq, lastDiff = _a.lastDiff, diff = _a.diff;\n                var result;\n                if (onQueryUpdated) {\n                    if (!diff) {\n                        var info = oq[\"queryInfo\"];\n                        info.reset();\n                        diff = info.getDiff();\n                    }\n                    result = onQueryUpdated(oq, diff, lastDiff);\n                }\n                if (!onQueryUpdated || result === true) {\n                    result = oq.refetch();\n                }\n                if (result !== false) {\n                    results.set(oq, result);\n                }\n                if (queryId.indexOf(\"legacyOneTimeQuery\") >= 0) {\n                    _this.stopQueryNoBroadcast(queryId);\n                }\n            });\n        }\n        if (removeOptimistic) {\n            this.cache.removeOptimistic(removeOptimistic);\n        }\n        return results;\n    };\n    QueryManager.prototype.fetchQueryByPolicy = function (queryInfo, _a, networkStatus) {\n        var _this = this;\n        var query = _a.query, variables = _a.variables, fetchPolicy = _a.fetchPolicy, refetchWritePolicy = _a.refetchWritePolicy, errorPolicy = _a.errorPolicy, returnPartialData = _a.returnPartialData, context = _a.context, notifyOnNetworkStatusChange = _a.notifyOnNetworkStatusChange;\n        var oldNetworkStatus = queryInfo.networkStatus;\n        queryInfo.init({\n            document: this.transform(query).document,\n            variables: variables,\n            networkStatus: networkStatus,\n        });\n        var readCache = function () { return queryInfo.getDiff(variables); };\n        var resultsFromCache = function (diff, networkStatus) {\n            if (networkStatus === void 0) { networkStatus = queryInfo.networkStatus || NetworkStatus.loading; }\n            var data = diff.result;\n            if (__DEV__ &&\n                !returnPartialData &&\n                !equal(data, {})) {\n                logMissingFieldErrors(diff.missing);\n            }\n            var fromData = function (data) { return Observable.of(__assign({ data: data, loading: isNetworkRequestInFlight(networkStatus), networkStatus: networkStatus }, (diff.complete ? null : { partial: true }))); };\n            if (data && _this.transform(query).hasForcedResolvers) {\n                return _this.localState.runResolvers({\n                    document: query,\n                    remoteResult: { data: data },\n                    context: context,\n                    variables: variables,\n                    onlyRunForcedResolvers: true,\n                }).then(function (resolved) { return fromData(resolved.data || void 0); });\n            }\n            if (errorPolicy === 'none' &&\n                networkStatus === NetworkStatus.refetch &&\n                Array.isArray(diff.missing)) {\n                return fromData(void 0);\n            }\n            return fromData(data);\n        };\n        var cacheWriteBehavior = fetchPolicy === \"no-cache\" ? 0 :\n            (networkStatus === NetworkStatus.refetch &&\n                refetchWritePolicy !== \"merge\") ? 1\n                : 2;\n        var resultsFromLink = function () { return _this.getResultsFromLink(queryInfo, cacheWriteBehavior, {\n            variables: variables,\n            context: context,\n            fetchPolicy: fetchPolicy,\n            errorPolicy: errorPolicy,\n        }); };\n        var shouldNotify = notifyOnNetworkStatusChange &&\n            typeof oldNetworkStatus === \"number\" &&\n            oldNetworkStatus !== networkStatus &&\n            isNetworkRequestInFlight(networkStatus);\n        switch (fetchPolicy) {\n            default:\n            case \"cache-first\": {\n                var diff = readCache();\n                if (diff.complete) {\n                    return [\n                        resultsFromCache(diff, queryInfo.markReady()),\n                    ];\n                }\n                if (returnPartialData || shouldNotify) {\n                    return [\n                        resultsFromCache(diff),\n                        resultsFromLink(),\n                    ];\n                }\n                return [\n                    resultsFromLink(),\n                ];\n            }\n            case \"cache-and-network\": {\n                var diff = readCache();\n                if (diff.complete || returnPartialData || shouldNotify) {\n                    return [\n                        resultsFromCache(diff),\n                        resultsFromLink(),\n                    ];\n                }\n                return [\n                    resultsFromLink(),\n                ];\n            }\n            case \"cache-only\":\n                return [\n                    resultsFromCache(readCache(), queryInfo.markReady()),\n                ];\n            case \"network-only\":\n                if (shouldNotify) {\n                    return [\n                        resultsFromCache(readCache()),\n                        resultsFromLink(),\n                    ];\n                }\n                return [resultsFromLink()];\n            case \"no-cache\":\n                if (shouldNotify) {\n                    return [\n                        resultsFromCache(queryInfo.getDiff()),\n                        resultsFromLink(),\n                    ];\n                }\n                return [resultsFromLink()];\n            case \"standby\":\n                return [];\n        }\n    };\n    QueryManager.prototype.getQuery = function (queryId) {\n        if (queryId && !this.queries.has(queryId)) {\n            this.queries.set(queryId, new QueryInfo(this, queryId));\n        }\n        return this.queries.get(queryId);\n    };\n    QueryManager.prototype.prepareContext = function (context) {\n        if (context === void 0) { context = {}; }\n        var newContext = this.localState.prepareContext(context);\n        return __assign(__assign({}, newContext), { clientAwareness: this.clientAwareness });\n    };\n    return QueryManager;\n}());\nexport { QueryManager };\n"],"mappings":"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"},"metadata":{},"sourceType":"module"}